###Severe Weather Events' Effects on Human Health and Local Economies

###Synopsis

###Data Processing

The following documents the steps to ingest, clean, and analyze the weather data provided by the National Oceanic and Atmospheric Administration (NOAA).  This data catalogs various weather events from 1950 thorough late 2011, as well as measures defining the impact of each storm on human health/safety and economic damage.

_**Data Ingestion**_

NOAA's data is available for this study through the hosting platform cloudfront.net. Below, we note this resource and download the content directly. Noting the date and time of the download, we store the raw data after unzipping the file and pulling in the .csv file within.

```{r data download, cache = TRUE, warning = FALSE}
library(R.utils)
library(lubridate)
URL <- "http://d396qusza40orc.cloudfront.net/repdata%2Fdata%2FStormData.csv.bz2"
download.time <- date()
download.file(URL, ".\\data\\StormData.csv.bz2")
bunzip2(".\\data\\StormData.csv.bz2", ".\\data\\StormData.csv")
raw.storm.data <- read.csv(".\\data\\StormData.csv")
```

_**Processing**_

In the next phase, we start with the raw data to focus in on and clean the variables and observations of interest to the purpose of the study.

```{r process data}
library(stringr)
## examine the variables present in the whole dataset
str(raw.storm.data)
## subset the raw data to just the variables of interest
storm.data <- raw.storm.data[names(raw.storm.data) %in% c("BGN_DATE", "EVTYPE", 
                                                          "FATALITIES", "INJURIES",
                                                          "PROPDMG", "PROPDMGEXP",
                                                          "CROPDMG", "CROPDMGEXP",
                                                          "REFNUM")]
## convert the date field to the proper format
## rename to simply DATE
storm.data$DATE <- mdy_hms(storm.data$BGN_DATE)
## note the discrepancy in the stated number (48) of EVTYPE categories and the 
## number actually present
length(unique(storm.data$EVTYPE))
## Execute rudimentary clean up steps to handle "easy cases" of lower case and
## leading white space
storm.data$EVTYPE <- toupper(storm.data$EVTYPE)
storm.data$EVTYPE <- str_trim(storm.data$EVTYPE)
## Convert disparate EVTYPE entries to logical groups:
## 1) initialize new variable
storm.data$EVTYPE.groups <- storm.data$EVTYPE
## 2) convert anything referencing cold or chill to simply "COLD"
storm.data$EVTYPE.groups[grepl("COLD", storm.data$EVTYPE.groups) == TRUE |
                         grepl("CHILL", storm.data$EVTYPE.groups) == TRUE |
                         grepl("FREEZE", storm.data$EVTYPE.groups) == TRUE |
                         grepl("FROST", storm.data$EVTYPE.groups) == TRUE |
                         grepl("RECORD LOW", storm.data$EVTYPE.groups) == TRUE |
                         grepl("COOL", storm.data$EVTYPE.groups) == TRUE |
                         grepl("HYPOTHERMIA", storm.data$EVTYPE.groups) == TRUE | 
                         grepl("LOW [T][E][M][P]", storm.data$EVTYPE.groups) == TRUE] <- "COLD"
## 3) convert anything referencing wind to simply "WIND"
storm.data$EVTYPE.groups[grepl("[W][I]?[N][D]", storm.data$EVTYPE.groups) == TRUE | 
                         grepl("DRY MICROBURST", storm.data$EVTYPE.groups) == TRUE | 
                         grepl("TURBULENCE", storm.data$EVTYPE.groups) == TRUE] <- "WIND"
## 4) convert anything referencing rising water to simply "FLOOD"
storm.data$EVTYPE.groups[grepl("SURGE", storm.data$EVTYPE.groups) == TRUE | 
                         grepl("FLOOD", storm.data$EVTYPE.groups) == TRUE |
                         grepl("WAVE", storm.data$EVTYPE.groups) == TRUE |
                         grepl("TIDE", storm.data$EVTYPE.groups) == TRUE | 
                         grepl("TSUNAMI", storm.data$EVTYPE.groups) == TRUE |
                         grepl("SURF", storm.data$EVTYPE.groups) == TRUE | 
                         grepl("FLD", storm.data$EVTYPE.groups) == TRUE | 
                         grepl("SWELL", storm.data$EVTYPE.groups) == TRUE | 
                         grepl("URBAN", storm.data$EVTYPE.groups) == TRUE |
                         grepl("WATER", storm.data$EVTYPE.groups) == TRUE |
                         grepl("STREAM", storm.data$EVTYPE.groups) == TRUE |
                         grepl("DAM", storm.data$EVTYPE.groups) == TRUE] <- "FLOOD"
## 5) convert anything referencing hurricanes or tropical storms to simply "HURRICANE/TROP"
storm.data$EVTYPE.groups[grepl("HURRICANE", storm.data$EVTYPE.groups) == TRUE | 
                         grepl("TYPHOON", storm.data$EVTYPE.groups) == TRUE |
                         grepl("FLOYD", storm.data$EVTYPE.groups) == TRUE |
                         grepl("TROPICAL", storm.data$EVTYPE.groups) == TRUE | 
                         grepl("[T][S][T][M]", storm.data$EVTYPE.groups) == TRUE] <- "HURRICANE/TROP"
## 6) convert anything referencing tornados to simply "TORNADO"
storm.data$EVTYPE.groups[grepl("[N][A][D][O]", storm.data$EVTYPE.groups) == TRUE | 
                         grepl("[T][O][R][N]", storm.data$EVTYPE.groups) == TRUE | 
                         grepl("[S][P][O][U][T]", storm.data$EVTYPE.groups) == TRUE | 
                         grepl("FUNNEL", storm.data$EVTYPE.groups) == TRUE | 
                         grepl("WALL CLOUD", storm.data$EVTYPE.groups) == TRUE] <- "TORNADO"
## 7) convert anything referencing snow/ice to simply "WINTER PRECIP"
storm.data$EVTYPE.groups[grepl("[S][N][O][W]", storm.data$EVTYPE.groups) == TRUE | 
                         grepl("WINTRY", storm.data$EVTYPE.groups) == TRUE |
                         grepl("[I][C][EY]", storm.data$EVTYPE.groups) == TRUE |
                         grepl("BLIZZARD", storm.data$EVTYPE.groups) == TRUE |
                         grepl("SLEET", storm.data$EVTYPE.groups) == TRUE | 
                         grepl("WINTER", storm.data$EVTYPE.groups) == TRUE |
                         grepl("[F][R][E][E][Z]", storm.data$EVTYPE.groups) == TRUE |
                         grepl("GLAZE", storm.data$EVTYPE.groups) == TRUE |
                         grepl("[M][I][X]", storm.data$EVTYPE.groups) == TRUE] <- "WINTER PREC"
## 8) convert anything referencing rain to simply "RAIN"
storm.data$EVTYPE.groups[grepl("[R][A][I][N]", storm.data$EVTYPE.groups) == TRUE | 
                         grepl("SHOWER", storm.data$EVTYPE.groups) == TRUE |
                         grepl("PRECIP", storm.data$EVTYPE.groups) == TRUE |
                         grepl("[B][U][R][S][T]", storm.data$EVTYPE.groups) == TRUE |
                         grepl("[W][E][T]", storm.data$EVTYPE.groups) == TRUE] <- "RAIN"
## 9) convert anything referencing hot or heat to simply "HEAT"
storm.data$EVTYPE.groups[grepl("HEAT", storm.data$EVTYPE.groups) == TRUE |
                         grepl("HOT", storm.data$EVTYPE.groups) == TRUE |
                         grepl("RECORD HIGH", storm.data$EVTYPE.groups) == TRUE |
                         grepl("HIGH", storm.data$EVTYPE.groups) == TRUE | 
                         grepl("HYPERTHERMIA", storm.data$EVTYPE.groups) == TRUE | 
                         grepl("WARM", storm.data$EVTYPE.groups) == TRUE] <- "HEAT"
## 10) convert anything referencing hail to simply "HAIL"
storm.data$EVTYPE.groups[grepl("HAIL", storm.data$EVTYPE.groups) == TRUE] <- "HAIL"
## 11) convert anything referencing fire to simply "FIRE"
storm.data$EVTYPE.groups[grepl("[F][I][R][E]", storm.data$EVTYPE.groups) == TRUE] <- "FIRE"
## 12) convert anything referencing storms to simply "STORM"
storm.data$EVTYPE.groups[grepl("[S][T][O][R][M]", storm.data$EVTYPE.groups) == TRUE | 
                         grepl("LIGHTNING", storm.data$EVTYPE.groups) == TRUE | 
                         grepl("LIGHTING", storm.data$EVTYPE.groups) == TRUE | 
                         grepl("LIGNTNING", storm.data$EVTYPE.groups) == TRUE] <- "STORM"
## 13) convert anything referencing sliding/avalanche to simply "COLLAPSE"
storm.data$EVTYPE.groups[grepl("AVALANC[H]?E", storm.data$EVTYPE.groups) == TRUE | 
                         grepl("LANDSLUMP", storm.data$EVTYPE.groups) == TRUE | 
                         grepl("EROSI[O]?N", storm.data$EVTYPE.groups) == TRUE | 
                         grepl("ERUPTION", storm.data$EVTYPE.groups) == TRUE | 
                         grepl("[S][L][I][D][E]", storm.data$EVTYPE.groups) == TRUE] <- "COLLAPSE"
## 14) convert anything referencing ocean conditions to simply "MARINE CONDITIONS"
storm.data$EVTYPE.groups[grepl("MARINE", storm.data$EVTYPE.groups) == TRUE | 
                         grepl("CURRENT[S]?", storm.data$EVTYPE.groups) == TRUE | 
                         grepl("DROWNING", storm.data$EVTYPE.groups) == TRUE | 
                         grepl("RED FLAG", storm.data$EVTYPE.groups) == TRUE | 
                         grepl("SEAS", storm.data$EVTYPE.groups) == TRUE] <- "MARINE CONDITIONS"
## 15) convert anything referencing low visibility conditions to simply "LOW VIZ"
storm.data$EVTYPE.groups[grepl("FOG", storm.data$EVTYPE.groups) == TRUE | 
                         grepl("VOG", storm.data$EVTYPE.groups) == TRUE | 
                         grepl("[D][U][S][T]", storm.data$EVTYPE.groups) == TRUE | 
                         grepl("SMOKE", storm.data$EVTYPE.groups) == TRUE | 
                         grepl("NORTHERN LIGHTS", storm.data$EVTYPE.groups) == TRUE |
                         grepl("ASH", storm.data$EVTYPE.groups) == TRUE] <- "LOW VIZ"
## 16) convert anything referencing dry conditions to simply "DROUGHT"
storm.data$EVTYPE.groups[grepl("[D][R][YI]", storm.data$EVTYPE.groups) == TRUE | 
                         grepl("DROUGHT", storm.data$EVTYPE.groups) == TRUE] <- "DROUGHT"
## 17) create object of valid event types based on 2-16 above and mark any  
## other event left as "NA"
events <- c("COLD", "WIND", "FLOOD", "HURRICANE/TROP", "TORNADO", "WINTER PREC", 
            "RAIN", "HEAT", "HAIL", "FIRE", "STORM", "COLLAPSE", "MARINE CONDITIONS",
            "LOW VIZ", "DROUGHT")
storm.data$EVTYPE.groups[(storm.data$EVTYPE.groups %in% events) == FALSE] <- "NA"
## with the recoding complete, convert the variable to a factor
storm.data$EVTYPE.groups <- as.factor(storm.data$EVTYPE.groups)
## examine the PROPDMGEXP/CROPDMGEXP to detemine how this data is characterized
unique(storm.data$PROPDMGEXP)
unique(storm.data$CROPDMGEXP)
## convert combination of PROPDMG/CROPDMG numeric and PROPDMGEXP/CROPDMGEXP exponent
## to numerical values for further analysis:
storm.data$PROPDMGEXP[grepl("0", storm.data$PROPDMGEXP) == TRUE | 
                      grepl("+", storm.data$PROPDMGEXP) == TRUE |
                      grepl("-", storm.data$PROPDMGEXP) == TRUE] <- 1
storm.data$CROPDMGEXP[grepl("0", storm.data$CROPDMGEXP) == TRUE] <- 1
storm.data$PROPDMGEXP[grepl("1", storm.data$PROPDMGEXP) == TRUE] <- 10
storm.data$PROPDMGEXP[grepl("[Hh]", storm.data$PROPDMGEXP) == TRUE | 
                      grepl("2", storm.data$PROPDMGEXP) == TRUE] <- 100
storm.data$CROPDMGEXP[grepl("[Hh]", storm.data$CROPDMGEXP) == TRUE | 
                      grepl("2", storm.data$CROPDMGEXP) == TRUE] <- 100
storm.data$PROPDMGEXP[grepl("[Kk]", storm.data$PROPDMGEXP) == TRUE | 
                      grepl("3", storm.data$PROPDMGEXP) == TRUE] <- 1000
storm.data$CROPDMGEXP[grepl("[Kk]", storm.data$CROPDMGEXP) == TRUE] <- 1000
storm.data$PROPDMGEXP[grepl("4", storm.data$PROPDMGEXP) == TRUE] <- 10000
storm.data$PROPDMGEXP[grepl("5", storm.data$PROPDMGEXP) == TRUE] <- 100000
storm.data$PROPDMGEXP[grepl("[Mm]", storm.data$PROPDMGEXP) == TRUE | 
                      grepl("6", storm.data$PROPDMGEXP) == TRUE] <- 1000000
storm.data$CROPDMGEXP[grepl("[Mm]", storm.data$CROPDMGEXP) == TRUE] <- 1000000
storm.data$PROPDMGEXP[grepl("7", storm.data$PROPDMGEXP) == TRUE] <- 10000000
storm.data$PROPDMGEXP[grepl("8", storm.data$PROPDMGEXP) == TRUE] <- 100000000
storm.data$PROPDMGEXP[grepl("[Bb]", storm.data$PROPDMGEXP) == TRUE] <- 1000000000
storm.data$CROPDMGEXP[grepl("[Bb]", storm.data$CROPDMGEXP) == TRUE] <- 1000000000
storm.data$PROPDMGEXP[grepl("?", storm.data$PROPDMGEXP) == TRUE] <- "NA"
storm.data$CROPDMGEXP[grepl("?", storm.data$CROPDMGEXP) == TRUE] <- "NA"
```

_**Analysis**_

###Results